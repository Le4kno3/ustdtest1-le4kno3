"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var path_1 = require("path");
var _1 = require(".");
function provideGetFortaConfig(filesystem, isProduction, configFilename, localConfigFilename, fortaKeystore, getJsonFile, contextPath) {
    _1.assertExists(filesystem, 'filesystem');
    _1.assertIsNonEmptyString(configFilename, 'configFilename');
    _1.assertIsNonEmptyString(localConfigFilename, 'localConfigFilename');
    _1.assertIsNonEmptyString(fortaKeystore, 'fortaKeystore');
    _1.assertExists(getJsonFile, 'getJsonFile');
    _1.assertIsNonEmptyString(contextPath, 'contextPath');
    return function getFortaConfig() {
        var config = {};
        var globalConfigPath = path_1.join(fortaKeystore, configFilename);
        var globalConfigExists = filesystem.existsSync(globalConfigPath);
        var localConfigPath = path_1.join(contextPath, localConfigFilename);
        var localConfigExists = filesystem.existsSync(localConfigPath);
        var noConfigExists = !globalConfigExists && !localConfigExists;
        if (noConfigExists || isProduction)
            return config;
        if (globalConfigExists) {
            try {
                config = Object.assign(config, getJsonFile(globalConfigPath));
            }
            catch (e) {
                throw new Error("unable to parse config file " + configFilename + ": " + e.message);
            }
        }
        if (localConfigExists) {
            try {
                config = Object.assign(config, getJsonFile(localConfigPath));
            }
            catch (e) {
                throw new Error("unable to parse project config file " + localConfigFilename + ": " + e.message);
            }
        }
        return config;
    };
}
exports.default = provideGetFortaConfig;
